uniblog.components.carousel={};

uniblog.common.component(
    "carousel",
    {
        options:{
            activeClass:"uni-carousel-active",
            animateClass:"uni-carousel-animate",
            slideWrap:".uni-carousel-container",
            slides:"figure",
            slideContent:".uni-carousel-slide-content",
            dragClass:"uni-carousel-dragging",
            arrowsContainer:".uni-carousel-arrows-container",
            infinite:!0,
            display:1,
            disableDragging:!1,
            next:".uni-carousel-right-arrow",
            prev:".uni-carousel-left-arrow",
            bullets:"nav button"
        },
        current:0,
        slides:[],
        sliding:!1,
        dragging:!1,
        dragThreshold:50,
        deltaX:0,
        init:function(){
            this.setElements();
            this.slideWrap&&this.slides&&(this.numSlides=this.slides.length,this.width=this.getWidth(),
                this.numSlides<this.options.display?this.sliding=!0:(this.options.infinite&&this.cloneSlides(this.options.display),
                    goog.dom.classlist.add(this.slides[0],this.options.activeClass),
                    this.setEvents(),
                    this.go(0)
                )
            )
        },
        setElements:function(){
            this.slideWrap=this.handler.querySelector(this.options.slideWrap);
            this.bullets=this.handler.querySelectorAll(this.options.bullets);
            this.nextButton=this.handler.querySelector(this.options.next);
            this.previousButton=this.handler.querySelector(this.options.prev);
            this.arrowsContainer=this.handler.querySelector(this.options.arrowsContainer);
            this.slideWrap&&(this.slides=this.slideWrap.querySelectorAll(this.options.slides))
        },
        setEvents:function(){
            this.options.disableDragging||(uniblog.utils.isTouchDevice?
                (
                    this.handler.addEventListener("touchstart",this.dragStart.bind(this)),
                    this.handler.addEventListener("touchmove",this.drag.bind(this)),
                    this.handler.addEventListener("touchend",this.dragEnd.bind(this)),
                    this.handler.addEventListener("touchcancel",this.dragEnd.bind(this))
                ):(
                    this.handler.addEventListener("mousedown",this.dragStart.bind(this)),
                    this.handler.addEventListener("mousemove",this.drag.bind(this)),
                    this.handler.addEventListener("mouseup",this.dragEnd.bind(this)),
                    this.handler.addEventListener("mouseleave",this.dragEnd.bind(this))
                )
            );
            this.arrowsContainer&&this.arrowsContainer.addEventListener("click",this.next.bind(this));
            this.previousButton&&this.previousButton.addEventListener("click",this.prev.bind(this));
            this.nextButton&&this.nextButton.addEventListener("click",this.next.bind(this));
            this.bullets&&this.bullets.length&&Array.prototype.forEach.call(this.bullets,function(a,b){
                a.index=b;
                a.addEventListener("click",this.onBulletClick.bind(this))
            }.bind(this));
            window.addEventListener("resize",this.updateView.bind(this));
            window.addEventListener("orientationchange",this.updateView.bind(this))
        },
        onBulletClick:function(a){
            a.preventDefault();
            this.go(a.target.index)
        },
        next:function(){
            this.options.infinite||this.current!==this.numSlides-1?
                this.go(this.current+1):
                this.go(this.numSlides-1)
        },
        prev:function(){
            this.options.infinite||0!==this.current?
                this.go(this.current-1):
                this.go(0)
        },
        go:function(a){
            if(!this.sliding){
                this.width=this.getWidth();
                if(0>a||a>=this.numSlides)
                    this.slide(-((0>a?this.current+this.numSlides:this.current-this.numSlides)*this.width-this.deltaX)+"px"),
                    this.slideWrap.offsetHeight;
                a=this.loop(a);
                if(this.options.onSlide)
                    this.options.onSlide(a,this.current);
                this.slide(-(a*this.width)+"px",!0);
                goog.dom.classlist.remove(
                    this.slides[this.current],
                    this.options.activeClass
                );
                goog.dom.classlist.add(this.slides[a],this.options.activeClass);
                this.slides[this.current].querySelector(".uni-carousel-image").tabIndex=-1;
                this.slides[a].querySelector(".uni-carousel-image").tabIndex=0;
                this.current=a;
                this.deltaX=0;
                this.updateNav(a);
                this.slideWrap.style.height=this.slides[a].querySelector(this.options.slideContent).offsetHeight+"px"
            }
        },
        setFocus:function(a){
            var b=this;
            setTimeout(function(){
                var c=b.slides[a].nodeName.toLowerCase();
                "a"===c||"button"===c||"0"===b.slides[a].getAttribute("tabindex")?
                    b.slides[a].focus():
                    b.slides[a].querySelector("a[href],[tabindex]").focus()
            },400)
        },
        updateNav:function(a){
            var b=this;
            this.options.infinite||(this.previousButton&&(0===a?goog.dom.classlist.add(this.previousButton,"disabled"):goog.dom.classlist.remove(this.previousButton,"disabled")),
            this.nextButton&&(a+1>=this.numSlides?goog.dom.classlist.add(this.nextButton,"disabled"):goog.dom.classlist.remove(this.nextButton,"disabled")));
            this.bullets&&0<this.bullets.length&&(Array.prototype.forEach.call(this.bullets,function(a){goog.dom.classlist.remove(a,b.options.activeClass)}),goog.dom.classlist.add(this.bullets[a],b.options.activeClass))},dragStart:function(a){var b;if(this.sliding)return!1;a=a.originalEvent||a;b=void 0!==a.touches?a.touches:!1;this.dragThresholdMet=!1;this.dragging=!0;this.cancel=!1;this.startClientX=b?b[0].pageX:a.clientX;this.startClientY=b?b[0].pageY:a.clientY;this.deltaY=this.deltaX=0;if("IMG"===a.target.tagName||"A"===a.target.tagName)a.target.draggable=
!1;goog.dom.classlist.contains(a.target,"rich-text")&&(this.dragging=!1)},drag:function(a){var b;this.dragging&&!this.cancel&&(a=a.originalEvent||a,b=void 0!==a.touches?a.touches:!1,this.deltaX=(b?b[0].pageX:a.clientX)-this.startClientX,this.deltaY=(b?b[0].pageY:a.clientY)-this.startClientY,this.dragThresholdMet||Math.abs(this.deltaX)>Math.abs(this.deltaY)&&10<Math.abs(this.deltaX)?(a.preventDefault(),this.dragThresholdMet=!0,this.slide(this.deltaX+this.width*-this.current+"px"),goog.dom.classlist.add(this.handler,
this.options.dragClass)):Math.abs(this.deltaY)>Math.abs(this.deltaX)&&10<Math.abs(this.deltaY)&&(this.cancel=!0))},dragEnd:function(){this.dragging&&!this.cancel&&(this.dragging=!1,goog.dom.classlist.remove(this.handler,this.options.dragClass),0!==this.deltaX&&Math.abs(this.deltaX)<this.dragThreshold?(this.go(this.current),this.setFocus(this.current)):0<this.deltaX?(this.prev(),this.setFocus(this.current)):0>this.deltaX&&(this.next(),this.setFocus(this.current)))},slide:function(a,b){if(b){this.sliding=
!0;goog.dom.classlist.add(this.handler,this.options.animateClass);var c=this;setTimeout(function(){c.sliding=!1;goog.dom.classlist.remove(c.handler,c.options.animateClass)},400)}this.slideWrap.style.transform="translate3d("+a+", 0, 0)"},loop:function(a){return(this.numSlides+a%this.numSlides)%this.numSlides},updateView:function(){var a=this;clearTimeout(this.timer);this.timer=setTimeout(function(){a.go(a.current);a.setWrapPosition()},300)},cloneSlides:function(){var a,b,c,d;a=this.options.offscreen||
1;b=this.options.display+a-1;b=b>this.numSlides?this.numSlides:b;for(d=this.numSlides;d>this.numSlides-a;d--)c=this.slides[d-1].cloneNode(!0),c.removeAttribute("id"),c.setAttribute("aria-hidden","true"),goog.dom.classlist.add(c,"clone"),this.slideWrap.insertBefore(c,this.slideWrap.firstChild);for(d=0;d<b;d++)c=this.slides[d].cloneNode(!0),c.removeAttribute("id"),c.setAttribute("aria-hidden","true"),goog.dom.classlist.add(c,"clone"),this.slideWrap.appendChild(c);this.setWrapPosition()},getWidth:function(){var a=
this.slideWrap.offsetWidth;this.slideWrap.children.length&&(a+=2*this.slideWrap.children[0].offsetLeft);return a},setWrapPosition:function(){this.slideWrap.style.marginLeft="calc("+-(this.options.offscreen||1)+"00% + "+(this.slides[0].offsetWidth-this.slides[0].offsetLeft)+"px)"}});